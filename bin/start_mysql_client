#!/usr/bin/env python

import argparse
import os

import sqlemon
import sqlemon.connection_strings as sqlcs

parser = argparse.ArgumentParser(description='Start SQL client')
parser.add_argument(
        '--role',
        help="Role in which the client is acting")
args = parser.parse_args()
role = args.role
project = os.environ['SQLEMON_PROJECT']


config = sqlemon.get_sql_configuration(project, role)
app_config = sqlemon.get_app_configuration()

if role == 'cloud':
    command = sqlcs.MYSQL_CLIENT_CLOUD.format(
            app_config['env_variables']['CLOUD_SQL_USER'],
            config['PASSWORD'],
            app_config['env_variables']['INSTANCE_CONNECTION_NAME'])
elif role == 'local':
    command = sqlcs.MYSQL_CLIENT_LOCAL.format(
            config['USER'],
            config['PASSWORD'],
            config['HOST'],
            config['PORT'])
else:
    raise ValueError("role {} not supported".format(role))

os.system(command)
