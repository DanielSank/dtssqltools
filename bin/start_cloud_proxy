#!/usr/bin/env python

import argparse
import os

import sqlemon

parser = argparse.ArgumentParser(description='Start Cloud SQL proxy')

project = os.environ['SQLEMON_PROJECT']

app_config = sqlemon.get_app_configuration()

print("Starting proxy for project {}".format(project))
os.system("cloud_sql_proxy -instances={} -dir={} -credential_file={}".format(
    app_config['env_variables']['INSTANCE_CONNECTION_NAME'],
    "/tmp/cloudsql",
    sqlemon.get_auth_token_filepath(project)))
